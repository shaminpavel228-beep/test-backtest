// ============================================
drawDashboard() =>
    if barstate.islast and showDashboard
        tablePos = switch dashboardPosition
            "Top Left" => position.top_left
            "Top Center" => position.top_center
            "Top Right" => position.top_right
            "Bottom Left" => position.bottom_left
            "Bottom Center" => position.bottom_center
            "Bottom Right" => position.bottom_right
            => position.top_right

// –§–ò–ö–°–ò–†–£–ï–ú 3 –ö–û–õ–û–ù–ö–ò (—É–±—Ä–∞–ª–∏ dashboardColumns)
dash = table.new(tablePos, 3, 45, bgcolor = color.new(#000000, 80), border_color = color.new(#555555, 50))
row = 0

// –ó–ê–ì–û–õ–û–í–û–ö (–≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º)
table.cell(dash, 0, row, "üéõÔ∏è –ë–ï–ö–¢–ï–°–¢ –î–õ–Ø –°–¢–†–ê–¢–ï–ì–ò–ô", bgcolor = color.new(#4A148C, 90), text_color = color.white, text_size = size.normal)
table.cell(dash, 1, row, "–í–µ—Ä—Å–∏—è 3.7", bgcolor = color.new(#4A148C, 90), text_color = color.yellow, text_size = size.small)
table.cell(dash, 2, row, timeframe.period, bgcolor = color.new(#4A148C, 90), text_color = color.white, text_size = size.small)

row := row + 1

// 1. ‚ö° –°–¢–ê–¢–£–°
if showStatusSection
table.cell(dash, 0, row, "‚ö° –°–¢–ê–¢–£–°", bgcolor = color.new(#1A237E, 70), text_color = color.white)
table.cell(dash, 1, row, "–ë–æ—Ç:", text_color = color.gray)
statusText = botStopped ? "–û–°–¢–ê–ù–û–í–õ–ï–ù" : tradingEnabled ? "–ê–ö–¢–ò–í–ï–ù" : "–ü–ê–£–ó–ê"
statusColor = botStopped ? color.red : tradingEnabled ? color.green : color.orange
table.cell(dash, 2, row, statusText, text_color = statusColor)

row := row + 1

// 2. ‚è≥ –í–†–ï–ú–ï–ù–ù–û–ô –ü–ï–†–ò–û–î
if showTimePeriod
table.cell(dash, 0, row, "‚è≥ –í–†–ï–ú–ï–ù–ù–û–ô –ü–ï–†–ò–û–î", bgcolor = color.new(#1A237E, 70), text_color = color.white)

// –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –¥—Ä—É–≥–∏–º–∏ –∏–º–µ–Ω–∞–º–∏
localStartDateStr = useCustomStartDate ? formatDate(startDate) : "–ù–ê–ß–ê–õ–û –ì–†–ê–§–ò–ö–ê"
localEndDateStr = useRealTimeEnd ? "–ò–î–ï–¢ –¢–û–†–ì–û–í–õ–Ø" : formatDate(endDate)

table.cell(dash, 1, row, localStartDateStr + " -", text_color = color.gray)
table.cell(dash, 2, row, localEndDateStr, text_color = color.white)

row := row + 1

// 3. ‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò
if showSettingsSection
table.cell(dash, 0, row, "‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò", bgcolor = color.new(#1A237E, 70), text_color = color.white)
table.cell(dash, 1, row, "–†–µ–∂–∏–º:", text_color = color.gray)
botColor = botMode == "–û–±–∞" ? color.orange : botMode == "–¢–æ–ª—å–∫–æ –õ–æ–Ω–≥" ? color.green : color.red
table.cell(dash, 2, row, botMode, text_color = botColor)

row := row + 1

table.cell(dash, 0, row, "", text_color = color.gray)
table.cell(dash, 1, row, "–ú–∞—Ä–∂–∞:", text_color = color.gray)
table.cell(dash, 2, row, marginType, text_color = color.blue)

row := row + 1

table.cell(dash, 0, row, "", text_color = color.gray)
table.cell(dash, 1, row, "–ü–ª–µ—á–æ:", text_color = color.gray)
table.cell(dash, 2, row, str.tostring(leverage) + "x", text_color = color.yellow)

row := row + 1

// 4. üìä –†–ò–°–ö
if showRiskSection
table.cell(dash, 0, row, "üìä –†–ò–°–ö", bgcolor = color.new(#1A237E, 70), text_color = color.white)
table.cell(dash, 1, row, "% –æ—Ç –¥–µ–ø–æ–∑–∏—Ç–∞:", text_color = color.gray)
table.cell(dash, 2, row, str.tostring(riskPerTrade, "#.#") + "%", text_color = color.yellow)

row := row + 1

// 5. üí∞ –ö–ê–ü–ò–¢–ê–õ
if showCapitalSection
table.cell(dash, 0, row, "üí∞ –ö–ê–ü–ò–¢–ê–õ", bgcolor = color.new(#1A237E, 70), text_color = color.white)
table.cell(dash, 1, row, "–ù–∞—á–∞–ª—å–Ω—ã–π:", text_color = color.gray)
table.cell(dash, 2, row, "$" + str.tostring(initialDeposit, "#.##"), text_color = color.white)

row := row + 1

table.cell(dash, 0, row, "", text_color = color.gray)
table.cell(dash, 1, row, "–¢–µ–∫—É—â–∏–π:", text_color = color.gray)
balanceColor = currentBalance >= initialDeposit ? color.green : color.red
table.cell(dash, 2, row, "$" + str.tostring(currentBalance, "#.##"), text_color = balanceColor)

row := row + 1

profitPercent = ((currentBalance - initialDeposit) / initialDeposit) * 100
table.cell(dash, 0, row, "", text_color = color.gray)
table.cell(dash, 1, row, "–ü—Ä–∏–±—ã–ª—å:", text_color = color.gray)
table.cell(dash, 2, row, str.tostring(profitPercent, "#.##") + "%", text_color = profitPercent >= 0 ? color.green : color.red)

row := row + 1

// 6. üí∞ –ü–†–ò–ë–´–õ–¨
if showProfitSection
table.cell(dash, 0, row, "üí∞ –ü–†–ò–ë–´–õ–¨", bgcolor = color.new(#4A148C, 80), text_color = color.white)
table.cell(dash, 1, row, "–í—Å–µ–≥–æ:", text_color = color.gray)
table.cell(dash, 2, row, "$" + str.tostring(totalProfit, "#.##"), text_color = totalProfit >= 0 ? color.green : color.red)

row := row + 1

table.cell(dash, 0, row, "", text_color = color.gray)
table.cell(dash, 1, row, "–ö–æ–º–∏—Å—Å–∏–∏:", text_color = color.gray)
table.cell(dash, 2, row, "$" + str.tostring(totalCommission, "#.##"), text_color = color.orange)

row := row + 1

// 7. üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê
if showStatisticsSection
table.cell(dash, 0, row, "üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê", bgcolor = color.new(#1A237E, 70), text_color = color.white)
table.cell(dash, 1, row, "–ü–æ–±–µ–¥:", text_color = color.gray)
table.cell(dash, 2, row, str.tostring(totalWins), text_color = color.green)

row := row + 1

table.cell(dash, 0, row, "", text_color = color.gray)
table.cell(dash, 1, row, "–ü–æ—Ä–∞–∂–µ–Ω–∏–π:", text_color = color.gray)
table.cell(dash, 2, row, str.tostring(totalLosses), text_color = color.red)

row := row + 1

winRate = totalWins + totalLosses > 0 ? (totalWins / (totalWins + totalLosses)) * 100 : 0
table.cell(dash, 0, row, "", text_color = color.gray)
table.cell(dash, 1, row, "–í–∏–Ω—Ä–µ–π—Ç:", text_color = color.gray)
table.cell(dash, 2, row, str.tostring(winRate, "#.##") + "%", text_color = winRate >= 50 ? color.green : color.red)

row := row + 1

// 8. üìä –ò–ù–î–ò–ö–ê–¢–û–†–´
if showIndicatorsSection
table.cell(dash, 0, row, "üìä –ò–ù–î–ò–ö–ê–¢–û–†–´", bgcolor = color.new(#1A237E, 70), text_color = color.white)
table.cell(dash, 1, row, "RSI:", text_color = color.gray)
rsiColor = rsi <= 30 ? color.green : rsi >= 70 ? color.red : color.white
table.cell(dash, 2, row, str.tostring(rsi, "#.##"), text_color = rsiColor)

row := row + 1

table.cell(dash, 0, row, "", text_color = color.gray)
table.cell(dash, 1, row, "BB:", text_color = color.gray)
bbPos = close <= bbLower ? "–ù–ò–ó" : close >= bbUpper ? "–í–ï–†–•" : "–°–†–ï–î"
bbPosColor = close <= bbLower ? color.green : close >= bbUpper ? color.red : color.gray
table.cell(dash, 2, row, bbPos, text_color = bbPosColor)

row := row + 1

table.cell(dash, 0, row, "", text_color = color.gray)
table.cell(dash, 1, row, "–¶–µ–Ω–∞:", text_color = color.gray)
table.cell(dash, 2, row, str.tostring(close, "#.#####"), text_color = color.white)

row := row + 1

// 9. üéØ –°–ò–ì–ù–ê–õ–´
if showSignalsSection
table.cell(dash, 0, row, "üéØ –°–ò–ì–ù–ê–õ–´", bgcolor = color.new(#1A237E, 70), text_color = color.white)
table.cell(dash, 1, row, "RSI:", text_color = color.gray)
rsiSignal = rsiLongSignal or rsiShortSignal
table.cell(dash, 2, row, rsiSignal ? "–î–ê" : "–ù–ï–¢", text_color = rsiSignal ? color.green : color.red)

row := row + 1

table.cell(dash, 0, row, "", text_color = color.gray)
table.cell(dash, 1, row, "BB:", text_color = color.gray)
bbSignal = bbLongSignal or bbShortSignal
table.cell(dash, 2, row, bbSignal ? "–î–ê" : "–ù–ï–¢", text_color = bbSignal ? color.green : color.red)

row := row + 1

// 10. üìà –ü–û–ó–ò–¶–ò–Ø
if showPositionSection
table.cell(dash, 0, row, "üìà –ü–û–ó–ò–¶–ò–Ø", bgcolor = color.new(#1A237E, 70), text_color = color.white)
if longPositionActive
table.cell(dash, 1, row, "–õ–û–ù–ì", bgcolor = color.new(#1B5E20, 70), text_color = color.white)
else if shortPositionActive
table.cell(dash, 1, row, "–®–û–†–¢", bgcolor = color.new(#B71C1C, 70), text_color = color.white)
else
table.cell(dash, 1, row, "–ù–ï–¢", bgcolor = color.new(#424242, 70), text_color = color.white)

if longPositionActive or shortPositionActive
table.cell(dash, 2, row, "–ê–ö–¢–ò–í–ù–ê", text_color = color.green)
else
table.cell(dash, 2, row, "–û–ñ–ò–î–ê–ù–ò–ï", text_color = color.gray)

row := row + 1

if longPositionActive
avgPriceLong = calculateAveragePrice(longAvgPrices, longAvgVolumes)
table.cell(dash, 0, row, "–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞:", text_color = color.gray)
table.cell(dash, 1, row, str.tostring(avgPriceLong, "#.#####"), text_color = color.green)
currentPLLong = not na(avgPriceLong) ? ((close - avgPriceLong) / avgPriceLong) * 100 : 0
table.cell(dash, 2, row, str.tostring(currentPLLong, "#.##") + "%", text_color = currentPLLong >= 0 ? color.green : color.red)

row := row + 1

// –£—Å—Ä–µ–¥–Ω–µ–Ω–∏—è –¥–ª—è –ª–æ–Ω–≥–∞
if useAveraging and longAvgCount > 0
table.cell(dash, 0, row, "–£—Å—Ä–µ–¥–Ω–µ–Ω–∏–π:", text_color = color.gray)
table.cell(dash, 1, row, str.tostring(longAvgCount), text_color = longAvgCount > 0 ? color.orange : color.gray)
table.cell(dash, 2, row, "", text_color = color.gray)

row := row + 1

else if shortPositionActive
avgPriceShort = calculateAveragePrice(shortAvgPrices, shortAvgVolumes)
table.cell(dash, 0, row, "–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞:", text_color = color.gray)
table.cell(dash, 1, row, str.tostring(avgPriceShort, "#.#####"), text_color = color.red)
currentPLShort = not na(avgPriceShort) ? ((avgPriceShort - close) / avgPriceShort) * 100 : 0
table.cell(dash, 2, row, str.tostring(currentPLShort, "#.##") + "%", text_color = currentPLShort >= 0 ? color.green : color.red)

row := row + 1

// –£—Å—Ä–µ–¥–Ω–µ–Ω–∏—è –¥–ª—è —à–æ—Ä—Ç–∞
if useAveraging and shortAvgCount > 0
table.cell(dash, 0, row, "–£—Å—Ä–µ–¥–Ω–µ–Ω–∏–π:", text_color = color.gray)
table.cell(dash, 1, row, str.tostring(shortAvgCount), text_color = shortAvgCount > 0 ? color.orange : color.gray)
table.cell(dash, 2, row, "", text_color = color.gray)

row := row + 1

else
table.cell(dash, 0, row, "–°—Ç–∞—Ç—É—Å:", text_color = color.gray)
table.cell(dash, 1, row, "–û–∂–∏–¥–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞", text_color = color.white)
table.cell(dash, 2, row, "", text_color = color.gray)

row := row + 1

// 11. üéØ –¢–ï–ö–£–©–ò–ô –°–ò–ì–ù–ê–õ
if showCurrentSignalSection
canTrade = tradingEnabled and not anyPositionActive and not botStopped

signalBg = color.new(#424242, 80)
if canTrade and finalLongSignal and (botMode == "–û–±–∞" or botMode == "–¢–æ–ª—å–∫–æ –õ–æ–Ω–≥")
signalBg := color.new(#1B5E20, 80)
else if canTrade and finalShortSignal and (botMode == "–û–±–∞" or botMode == "–¢–æ–ª—å–∫–æ –®–æ—Ä—Ç")
signalBg := color.new(#B71C1C, 80)

table.cell(dash, 0, row, "üéØ –¢–ï–ö–£–©–ò–ô –°–ò–ì–ù–ê–ª", bgcolor = signalBg, text_color = color.white)
signalText = ""
if botStopped
signalText := "–ë–û–¢ –û–°–¢–ê–ù–û–í–õ–ï–ù"
else if tradingEnabled == false
signalText := "–¢–û–†–ì–û–í–õ–Ø –ü–†–ò–û–°–¢–ê–ù–û–í–õ–ï–ù–ê"
else if anyPositionActive
signalText := "–ü–û–ó–ò–¶–ò–Ø –û–¢–ö–†–´–¢–ê"
else if finalLongSignal and (botMode == "–û–±–∞" or botMode == "–¢–æ–ª—å–∫–æ –õ–æ–Ω–≥")
signalText := "–õ–û–ù–ì üü¢"
else if finalShortSignal and (botMode == "–û–±–∞" or botMode == "–¢–æ–ª—å–∫–æ –®–æ—Ä—Ç")
signalText := "–®–û–†–¢ üî¥"
else
signalText := "–û–ñ–ò–î–ê–ù–ò–ï ‚ö™"

signalColor = color.gray
if signalText == "–õ–û–ù–ì üü¢"
signalColor := color.green
else if signalText == "–®–û–†–¢ üî¥"
signalColor := color.red

table.cell(dash, 1, row, signalText, text_color = signalColor, text_size = size.normal)

row := row + 1

